<!DOCTYPE html>
<html lang="{{ site.lang | default: 'ru-RU' }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
    
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  </head>

  <body>
    <header class="site-header">
      <div class="container">
        <div class="header-content">
          <a href="{{ '/' | relative_url }}" class="site-title">{{ site.title }}</a>
          <div class="header-controls">
            <button class="control-btn font-decrease" id="fontDecrease" aria-label="–£–º–µ–Ω—å—à–∏—Ç—å —à—Ä–∏—Ñ—Ç" title="–£–º–µ–Ω—å—à–∏—Ç—å —à—Ä–∏—Ñ—Ç">A-</button>
            <button class="control-btn font-increase" id="fontIncrease" aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å —à—Ä–∏—Ñ—Ç" title="–£–≤–µ–ª–∏—á–∏—Ç—å —à—Ä–∏—Ñ—Ç">A+</button>
            <button class="control-btn theme-toggle" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
            <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
              ‚ò∞
            </button>
          </div>
        </div>
      </div>
      
      <nav class="site-nav" id="siteNav">
        <div class="container">
          <ul class="nav-menu">
            {% for nav_item in site.navigation %}
              <li><a href="{{ nav_item.url | relative_url }}">{{ nav_item.title }}</a></li>
            {% endfor %}
          </ul>
        </div>
      </nav>
    </header>

    <main class="main-content">
      <div class="container">
        {{ content }}
      </div>
    </main>

    <footer class="site-footer">
      <div class="container">
        <p>&copy; {{ 'now' | date: '%Y' }} {{ site.title }}. –°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é Jekyll –∏ GitHub Pages.</p>
      </div>
    </footer>

    <script>
      // Mobile navigation toggle
      document.addEventListener('DOMContentLoaded', function() {
        const navToggle = document.getElementById('navToggle');
        const siteNav = document.getElementById('siteNav');
        
        navToggle.addEventListener('click', function() {
          siteNav.classList.toggle('active');
        });
        
        // Close menu when clicking on a link (mobile)
        const navLinks = siteNav.querySelectorAll('a');
        navLinks.forEach(function(link) {
          link.addEventListener('click', function() {
            siteNav.classList.remove('active');
          });
        });
        
        // Close menu when clicking outside (mobile)
        document.addEventListener('click', function(event) {
          if (!navToggle.contains(event.target) && !siteNav.contains(event.target)) {
            siteNav.classList.remove('active');
          }
        });

        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        // Load saved theme
        const savedTheme = localStorage.getItem('bookTheme') || 'light';
        body.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);
        
        themeToggle.addEventListener('click', function() {
          const currentTheme = body.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          
          body.setAttribute('data-theme', newTheme);
          localStorage.setItem('bookTheme', newTheme);
          updateThemeIcon(newTheme);
        });
        
        function updateThemeIcon(theme) {
          themeToggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        // Font size controls
        const fontIncrease = document.getElementById('fontIncrease');
        const fontDecrease = document.getElementById('fontDecrease');
        
        // Load saved font size
        const savedFontSize = localStorage.getItem('bookFontSize') || '100';
        document.documentElement.style.setProperty('--book-font-scale', savedFontSize + '%');
        
        fontIncrease.addEventListener('click', function() {
          const currentSize = getCurrentFontSize();
          const newSize = Math.min(currentSize + 10, 150); // Max 150%
          setFontSize(newSize);
        });
        
        fontDecrease.addEventListener('click', function() {
          const currentSize = getCurrentFontSize();
          const newSize = Math.max(currentSize - 10, 70); // Min 70%
          setFontSize(newSize);
        });
        
        function getCurrentFontSize() {
          const fontScale = getComputedStyle(document.documentElement).getPropertyValue('--book-font-scale');
          return parseInt(fontScale) || 100;
        }
        
        function setFontSize(size) {
          document.documentElement.style.setProperty('--book-font-scale', size + '%');
          localStorage.setItem('bookFontSize', size.toString());
        }

        // Reading progress tracking
        const currentPath = window.location.pathname;
        const decodedPath = decodeURIComponent(currentPath);
        
        // Save current page as last read
        if (decodedPath.includes('/–≥–ª–∞–≤–∞_')) {
          localStorage.setItem('bookLastRead', currentPath);
        }
        
        // Show reading progress indicator on home page
        if (currentPath.endsWith('/') || currentPath.endsWith('index.html')) {
          showReadingProgress();
        }
        
        function showReadingProgress() {
          const lastRead = localStorage.getItem('bookLastRead');
          if (lastRead) {
            // Find the link that matches the last read chapter
            const lastReadLink = document.querySelector(`a[href*="${lastRead}"]`);
            if (lastReadLink) {
              // Add visual indicator
              lastReadLink.classList.add('last-read');
              
              // Add "Continue reading" button if we're on the home page
              if (window.location.pathname === '{{ "/" | relative_url }}' || window.location.pathname.endsWith('/')) {
                // Extract part and chapter info from the path
                const decodedPath = decodeURIComponent(lastRead);
                const pathParts = decodedPath.split('/');
                let partName = '';
                let chapterName = lastReadLink.textContent || '–ì–ª–∞–≤–∞';
                
                // Extract part name from path
                const partSegment = pathParts.find(part => part.includes('—á–∞—Å—Ç—å_'));
                if (partSegment) {
                  const partNumber = partSegment.split('_')[1];
                  const partNames = {
                    '1': '–ò—Å—Ç–æ—Ä–∏—è –º–µ—Ç–∞–ª–ª—É—Ä–≥–∏–∏',
                    '2': '–û—Å–Ω–æ–≤—ã –º–µ—Ç–∞–ª–ª—É—Ä–≥–∏–∏', 
                    '3': '–ì–∞–ª–µ—Ä–µ—è –º–µ—Ç–∞–ª–ª–æ–≤',
                    '4': '–ú–µ—Ç–∞–ª–ª—ã –≤–æ–∫—Ä—É–≥ –Ω–∞—Å',
                    '5': '–ü—Ä–∞–∫—Ç–∏–∫–∞ –∏ –±—É–¥—É—â–µ–µ'
                  };
                  partName = partNames[partNumber] || '';
                }
                
                const continueDiv = document.createElement('div');
                continueDiv.className = 'continue-reading';
                continueDiv.innerHTML = `
                  <h3>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —á—Ç–µ–Ω–∏–µ</h3>
                  ${partName ? `<p class="continue-part">–ß–∞—Å—Ç—å ${partSegment?.split('_')[1]}: ${partName}</p>` : ''}
                  <a href="${lastRead}" class="continue-btn">${chapterName}</a>
                `;
                
                // Insert after hero section
                const hero = document.querySelector('.hero');
                if (hero && hero.nextElementSibling) {
                  hero.parentNode.insertBefore(continueDiv, hero.nextElementSibling);
                }
              }
            }
          }
        }
      });
    </script>
  </body>
</html>